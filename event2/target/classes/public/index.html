<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Event Registration Frontend Demo</title>
    <style>
        table {
            table-layout: fixed;
            width: 100%;

            border-collapse: collapse;
            margin: 0;
            padding: 0;
        }



        table th:nth-child(1),
        table td:nth-child(1) {
            width: auto;
        }

        table th:nth-child(2),
        table td:nth-child(2) {
            width: auto;
        }

        table th:nth-child(3),
        table td:nth-child(3) {
            width: auto;
        }

        table th:nth-child(4),
        table td:nth-child(4) {
            width: auto;
        }

        table th:nth-child(5),
        table td:nth-child(5) {
            width: auto;
        }
        table th:nth-child(5), table td:nth-child(5) { width: 80px; text-align: center; }



        table td,
        table th {
            border: 1px solid #ddd;
            padding: 8px;
        }

        table th {
            border-top: none;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
        }

        h1 {
            color: #333;
        }

        .main-controls {
            margin-bottom: 20px;
        }

        .create-button {
            padding: 10px 15px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        #events-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        #events-table th,
        #events-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        #events-table th {
            background-color: #007bff;
            color: white;
        }

        .status {
            margin-top: 15px;
            font-weight: bold;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 8px;
            position: relative;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .modal-content input {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            margin-bottom: 15px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .modal-content button[type="submit"] {
            padding: 10px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        .message {
            padding: 10px;
            margin-top: 15px;
            border-radius: 4px;
            font-weight: bold;
        }

        .success {
            background-color: #d4edda;
            color: #155724;
        }

        .error {
            background-color: #f8d7da;
            color: #721c24;
        }

        #event-table th:nth-child(6),
        #event-table td:nth-child(6) {
            width: auto;

        }




        .delete-btn {
            background-color: #dc3545;
            color: white;
            border: none;

            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;

            transition: background-color 0.3s ease;
        }

        .delete-btn:hover {
            background-color: #c82333;
        }

        .edit-btn {
            background-color: #007bff; 
            color: white;
            border: none;
            
            padding: 5px 10px;
            border-radius: 3px; 
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            margin-right: 80px; 
            
            transition: background-color 0.3s ease;
        }

        .edit-btn:hover {
            background-color: #0056b3;
        }
    </style>
</head>

<body>


    <div id="auth-overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#f4f4f9; z-index:1000; display:flex; justify-content:center; align-items:center; font-family: Arial, sans-serif;">
    <div style="background: white; padding: 40px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 350px;">
        
        <div style="display: flex; margin-bottom: 20px; border-bottom: 2px solid #eee;">
            <button onclick="toggleAuth('login')" id="tab-login" style="flex:1; padding:10px; border:none; background:none; cursor:pointer; font-weight:bold; border-bottom: 2px solid #007bff; color: #007bff;">Login</button>
            <button onclick="toggleAuth('signup')" id="tab-signup" style="flex:1; padding:10px; border:none; background:none; cursor:pointer; font-weight:bold; color: #666;">Sign Up</button>
        </div>

        <div id="login-form-container">
            <h3 style="margin-top:0;">Welcome Back</h3>
            <input type="text" id="login-user" placeholder="Username (admin)" style="width:100%; padding:12px; margin:10px 0; border:1px solid #ddd; border-radius:6px; box-sizing:border-box;">
            <input type="password" id="login-pass" placeholder="Password (1234)" style="width:100%; padding:12px; margin:10px 0; border:1px solid #ddd; border-radius:6px; box-sizing:border-box;">
            <button onclick="handleLogin()" style="width:100%; padding:12px; background:#007bff; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:bold; margin-top:10px;">Sign In</button>
        </div>

        <div id="signup-form-container" style="display: none;">
            <h3 style="margin-top:0;">Create Account</h3>
            <input type="text" id="signup-name" placeholder="Full Name" style="width:100%; padding:12px; margin:10px 0; border:1px solid #ddd; border-radius:6px; box-sizing:border-box;">
            <input type="text" id="signup-user" placeholder="Choose Username" style="width:100%; padding:12px; margin:10px 0; border:1px solid #ddd; border-radius:6px; box-sizing:border-box;">
            <input type="password" id="signup-pass" placeholder="Choose Password" style="width:100%; padding:12px; margin:10px 0; border:1px solid #ddd; border-radius:6px; box-sizing:border-box;">
            <button onclick="handleSignup()" style="width:100%; padding:12px; background:#28a745; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:bold; margin-top:10px;">Register</button>
        </div>

        <p id="auth-error-msg" style="color:red; font-size:14px; text-align:center; display:none; margin-top:15px;"></p>
    </div>
</div>




















    <h1>Event Registration System - Frontend Demo</h1>
    <p class="status" id="status-message">Status: Attempting to connect to Java Backend (EventAPI)...</p>

    <button onclick="handleLogout()" style="padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; float: right;">
        Log Out
    </button>

    <div class="main-controls">
        <button id="open-modal-btn" class="create-button">Create New Event</button>
    </div>

    <div id="event-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Create New Event</h2>
            <form id="event-form">
                <label for="title">Title:</label>
                <input type="text" id="title" name="title" required>

                <label for="date">Date:</label>
                <input type="date" id="date" name="date" required>

                <label for="location">Location:</label>
                <input type="text" id="location" name="location" required>

                <label for="capacity">Capacity:</label>
                <input type="number" id="capacity" name="capacity" required value="50">

                <label for="fee">Fee (£):</label>
                <input type="number" id="fee" name="fee" step="0.01" required value="0.00">

                <button type="submit" id="form-submit-btn">Add Event</button>
                <div id="form-message" class="message" style="display: none;"></div>

                <input type="hidden" id="event-id-hidden" name="eventIdHidden">
            </form>
        </div>
    </div>

    <h2>Available Events</h2>
    <table id="events-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Date</th>
                <th>Location</th>
                <th>Capacity</th>
                <th>Fee</th>
                <th>Actions</th>
            </tr>
        </thead>
        <table id="events-table">
            <thead>
            </thead>
            <tbody id="events-data-body">
                <tr>
                    <td colspan="7">Loading events...</td>
                </tr>
            </tbody>
        </table>
    </table>

<script>
    const API_URL = "http://localhost:5000/api/events";
    const statusElement = document.getElementById('status-message');
    const dataBody = document.getElementById('events-data-body');
    const eventForm = document.getElementById('event-form');
    const formMessage = document.getElementById('form-message');
    const formSubmitBtn = document.getElementById('form-submit-btn');
    const eventIdHidden = document.getElementById('event-id-hidden');

    // Modal elements
    const modal = document.getElementById('event-modal');
    const openBtn = document.getElementById('open-modal-btn');
    const closeSpan = document.getElementsByClassName('close')[0];

    // Modal Controls
    openBtn.onclick = function () {
        document.querySelector('.modal-content h2').textContent = 'Create New Event';
        formSubmitBtn.textContent = 'Add Event';
        formSubmitBtn.setAttribute('data-mode', 'create');
        eventForm.reset();
        eventIdHidden.value = '';
        modal.style.display = "block";
        formMessage.style.display = "none";
    }

    closeSpan.onclick = function () { modal.style.display = "none"; }
    window.onclick = function (event) { if (event.target == modal) modal.style.display = "none"; }

    // Fetch Data form api
    function fetchEvents() {
        statusElement.textContent = `Status: Loading events...`;
        fetch(API_URL)
            .then(response => response.json())
            .then(data => {
                statusElement.textContent = `Status:  Loaded ${data.length} events.`;
                if (data.length === 0) {
                    dataBody.innerHTML = '<tr><td colspan="6">No events found.</td></tr>';
                    return;
                }

                dataBody.innerHTML = data.map((event, index) => {
                    let rawDate = Array.isArray(event.date) ? event.date.join('-') : event.date;
                    let fee = event.fee && typeof event.fee === 'object' ? event.fee.val : event.fee;
                    let formattedFee = parseFloat(fee).toFixed(2);

                    return `
                            <tr>
                                <td>${index + 1}</td> <td>${event.title}</td>
                                <td>${rawDate}</td>
                                <td>${event.location}</td>
                                <td>${event.capacity}</td>
                                <td>£${formattedFee}</td>
                                <td>
                                    <button class="edit-btn" data-event-id="${event.eventId}">Edit</button>
                                    <button class="delete-btn" data-event-id="${event.eventId}">Delete</button>
                                </td>
                            </tr>`;
                }).join('');
            })
            .catch(error => {
                statusElement.textContent = `Status: Connection Failed!`;
                dataBody.innerHTML = '<tr><td colspan="6">Error loading data.</td></tr>';
            });
    }

    // Handle clicks (Edit/Delete) 
    document.addEventListener('click', function (e) {
        // Grab the ID from the button that was clicked
        const id = e.target.dataset.eventId;
        if (!id) return; 

        // LOGIC FOR EDIT BUTTONs
        if (e.target.classList.contains('edit-btn')) {
            fetch(API_URL)
                .then(res => res.json())
                .then(data => {
                    const event = data.find(ev => ev.eventId == id);
                    if (!event) return;

                    eventIdHidden.value = id;
                    document.getElementById('title').value = event.title || '';
                    document.getElementById('location').value = event.location || '';
                    document.getElementById('capacity').value = event.capacity || 50;
                    
                    if (Array.isArray(event.date)) {
                        const y = event.date[0];
                        const m = String(event.date[1]).padStart(2, '0');
                        const d = String(event.date[2]).padStart(2, '0');
                        document.getElementById('date').value = `${y}-${m}-${d}`;
                    }

                    let feeVal = event.fee && typeof event.fee === 'object' ? event.fee.val : event.fee;
                    document.getElementById('fee').value = parseFloat(feeVal || 0).toFixed(2);

                    document.querySelector('.modal-content h2').textContent = 'Edit Existing Event';
                    formSubmitBtn.textContent = 'Save Changes';
                    formSubmitBtn.setAttribute('data-mode', 'edit');
                    modal.style.display = "block";
                });
        }

        //  LOGIC FOR DELETE BUTTONs
        if (e.target.classList.contains('delete-btn')) {
            if (confirm(`Are you sure you want to delete this event? (ID: ${id})`)) {
                fetch(`${API_URL}/${id}`, {
                    method: 'DELETE'
                })
                .then(response => {
                    if (response.ok) {
                        // This just re-runs fetchEvent function to refresh the table
                        fetchEvents(); 
                    } else {
                        alert("The server refused to delete the event.");
                    }
                })
                .catch(error => {
                    console.error("Delete Error:", error);
                    alert("Could not connect to the server to delete.");
                });
            }
        }
    });

    // SAVE / CREATE LOGIC
    eventForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const mode = formSubmitBtn.getAttribute('data-mode');
        const id = eventIdHidden.value;
        
        const eventData = {
            title: document.getElementById('title').value,
            date: document.getElementById('date').value,
            location: document.getElementById('location').value,
            capacity: parseInt(document.getElementById('capacity').value),
            fee: parseFloat(document.getElementById('fee').value).toFixed(2)
        };

        let url = API_URL;
        let method = 'POST';

        if (mode === 'edit') {
            url = `${API_URL}/${id}`;
            method = 'PUT';
            eventData.eventId = parseInt(id); // Use eventId to match Java object
        }

        fetch(url, {
            method: method,
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(eventData)
        })
        .then(async response => { // Add async 
            if (response.ok) {
                formMessage.textContent = " Success!";
                formMessage.className = "message success";
                formMessage.style.display = "block";
                
                // Wait.....
                setTimeout(() => {
                    modal.style.display = "none";
                    fetchEvents();
                }, 1000);
            } else {
                const errorText = await response.text();
                throw new Error(errorText || "Server error");
            }
        })
        .catch(error => {
            formMessage.textContent = " Error: " + error.message;
            formMessage.className = "message error";
            formMessage.style.display = "block";
        });
    });


   function toggleAuth(mode) {
    const loginForm = document.getElementById('login-form-container');
    const signupForm = document.getElementById('signup-form-container');
    const loginTab = document.getElementById('tab-login');
    const signupTab = document.getElementById('tab-signup');
    const errorMsg = document.getElementById('auth-error-msg');

    errorMsg.style.display = 'none';

    if (mode === 'login') {
        loginForm.style.display = 'block';
        signupForm.style.display = 'none';
        loginTab.style.borderBottom = '2px solid #007bff';
        loginTab.style.color = '#007bff';
        signupTab.style.borderBottom = 'none';
        signupTab.style.color = '#666';
    } else {
        loginForm.style.display = 'none';
        signupForm.style.display = 'block';
        signupTab.style.borderBottom = '2px solid #28a745';
        signupTab.style.color = '#28a745';
        loginTab.style.borderBottom = 'none';
        loginTab.style.color = '#666';
    }
}

function handleLogin() {
    const user = document.getElementById('login-user').value;
    const pass = document.getElementById('login-pass').value;
    const errorMsg = document.getElementById('auth-error-msg');

    fetch(`${API_URL.replace('/events', '')}/login`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username: user, password: pass })
    })
    .then(res => {
        if (res.ok) {
            document.getElementById('auth-overlay').style.display = 'none';
            fetchEvents();
        } else {
            errorMsg.textContent = " Invalid username or password";
            errorMsg.style.display = 'block';
        }
    })
    .catch(() => {
        errorMsg.textContent = " Cannot connect to Java Server";
        errorMsg.style.display = 'block';
    });
}

function handleSignup() {
    const name = document.getElementById('signup-name').value;
    const user = document.getElementById('signup-user').value;
    const pass = document.getElementById('signup-pass').value;

    fetch(`${API_URL.replace('/events', '')}/signup`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name: name, username: user, password: pass })
    })
    .then(res => {
        if (res.ok) {
            alert("Success! Account created. Now please log in.");
            toggleAuth('login');
        } else {
            alert("Signup failed. Try a different username.");
        }
    });
}


function handleLogout() {
    if (confirm("Are you sure you want to log out?")) {
        //  Show the login overlay 
        document.getElementById('auth-overlay').style.display = 'flex';
        
        //  Clear the input fields so they are empty for next time
        document.getElementById('user-L').value = '';
        document.getElementById('pass-L').value = '';
        
        //  Optional: Clear the table data so it doesn't stay in the background
        document.getElementById('events-data-body').innerHTML = '<tr><td colspan="7" style="text-align: center;">Logged out. Please sign in.</td></tr>';
        
        console.log("User logged out.");
    }
}

    fetchEvents();
</script>

</body>







</html>